@* CardTitle - Header component for cards with icon, title, badges and help *@

<header class="card-title-header">
	<div class="card-title-left">
		@if (!string.IsNullOrEmpty(Icon))
		{
			<div class="card-title-icon @(IsImageIcon ? "card-title-icon-img" : "")">
				@if (IsImageIcon)
				{
					<img src="@Icon" alt="" />
				}
				else
				{
					<RadzenIcon Icon="@Icon"  />
				}
			</div>
		}
		<div class="card-title-text">
			<h3 class="card-title-main">@Title</h3>
			@if (!string.IsNullOrEmpty(Subtitle))
			{
				<p class="card-title-subtitle">@Subtitle</p>
			}
		</div>
		@if (Beta)
		{
			<span class="card-title-badge card-title-badge-beta">Beta</span>
		}
		@if (New)
		{
			<span class="card-title-badge card-title-badge-new">Nuevo</span>
		}
	</div>

	<div class="card-title-right">
		@if (Actions != null)
		{
			@Actions
		}
		@if (HelpContent != null || !string.IsNullOrEmpty(HelpLink))
		{
			<button type="button"
					class="card-title-help-btn @(helpIsVisible ? "active" : "")"
					@onclick="ToggleHelp"
					title="@(helpIsVisible ? "Ocultar ayuda" : "Mostrar ayuda")">
				<RadzenIcon Icon="@(helpIsVisible ? "close" : "help_outline")" />
			</button>
		}
	</div>
</header>

@if (helpIsVisible && (HelpContent != null || !string.IsNullOrEmpty(HelpLink)))
{
	<div class="card-title-help-panel">
		<div class="card-title-help-icon">
			<RadzenIcon Icon="lightbulb" />
		</div>
		<div class="card-title-help-content">
			@if (HelpContent != null)
			{
				@HelpContent
			}
			else if (!string.IsNullOrEmpty(HelpLink))
			{
				<a href="@HelpLink" target="_blank" rel="noopener noreferrer" class="card-title-help-link">
					<span>Ver documentacion</span>
					<RadzenIcon Icon="open_in_new" />
				</a>
			}
		</div>
		<button type="button" class="card-title-help-close" @onclick="ToggleHelp">
			<RadzenIcon Icon="keyboard_arrow_up" />
		</button>
	</div>
}

@code {
	[Parameter] public string Title { get; set; }
	[Parameter] public string Subtitle { get; set; }
	[Parameter] public string Icon { get; set; }
	[Parameter] public bool Beta { get; set; }
	[Parameter] public bool New { get; set; }
	[Parameter] public string HelpLink { get; set; }
	[Parameter] public RenderFragment HelpContent { get; set; }
	[Parameter] public RenderFragment Actions { get; set; }

	private bool helpIsVisible;

	private bool IsImageIcon => !string.IsNullOrEmpty(Icon) &&
		(Icon.StartsWith("/") || Icon.StartsWith("http://") || Icon.StartsWith("https://"));

	private void ToggleHelp()
	{
		helpIsVisible = !helpIsVisible;
	}
}

<style>
	.card-title-header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 1rem;
		margin-bottom: 1rem;
		min-height: 2.5rem;
	}

	.card-title-left {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		flex: 1;
		min-width: 0;
	}

	.card-title-icon {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 2.5rem;
		height: 2.5rem;
		border-radius: 0.5rem;
		background: var(--rz-primary-lighter);
		color: var(--rz-primary);
		flex-shrink: 0;
	}

	.card-title-icon .rzi {
		font-size: 1.25rem;
	}

	.card-title-icon-img {
		padding: 0.375rem;
		background: var(--rz-base-200);
	}

	.card-title-icon-img img {
		width: 100%;
		height: 100%;
		object-fit: contain;
		border-radius: 0.25rem;
	}

	.card-title-text {
		flex: 1;
		min-width: 0;
	}

	.card-title-main {
		margin: 0;
		font-size: 1.125rem;
		font-weight: 600;
		line-height: 1.3;
		color: var(--rz-text-color);
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
	}

	.card-title-subtitle {
		margin: 0.125rem 0 0 0;
		font-size: 0.8125rem;
		color: var(--rz-text-secondary-color);
		line-height: 1.4;
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
	}

	.card-title-badge {
		display: inline-flex;
		align-items: center;
		padding: 0.125rem 0.5rem;
		font-size: 0.6875rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.025em;
		border-radius: 1rem;
		flex-shrink: 0;
	}

	.card-title-badge-beta {
		background: var(--rz-danger-lighter);
		color: var(--rz-danger);
	}

	.card-title-badge-new {
		background: var(--rz-success-lighter);
		color: var(--rz-success);
	}

	.card-title-right {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		flex-shrink: 0;
	}

	.card-title-help-btn {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 2rem;
		height: 2rem;
		padding: 0;
		border: none;
		border-radius: 50%;
		background: transparent;
		color: var(--rz-text-secondary-color);
		cursor: pointer;
		transition: all 0.2s ease;
	}

	.card-title-help-btn:hover {
		background: var(--rz-base-200);
		color: var(--rz-primary);
	}

	.card-title-help-btn.active {
		background: var(--rz-primary-lighter);
		color: var(--rz-primary);
	}

	.card-title-help-btn .rzi {
		font-size: 1.125rem;
	}

	.card-title-help-panel {
		display: flex;
		align-items: flex-start;
		gap: 0.75rem;
		padding: 0.875rem 1rem;
		margin-bottom: 1rem;
		background: linear-gradient(135deg, var(--rz-info-lighter) 0%, transparent 100%);
		border: 1px solid var(--rz-info-light);
		border-radius: 0.5rem;
		animation: slideDown 0.2s ease;
	}

	@@keyframes slideDown {
		from {
			opacity: 0;
			transform: translateY(-0.5rem);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.card-title-help-icon {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 1.75rem;
		height: 1.75rem;
		border-radius: 50%;
		background: var(--rz-info);
		color: white;
		flex-shrink: 0;
	}

	.card-title-help-icon .rzi {
		font-size: 1rem;
	}

	.card-title-help-content {
		flex: 1;
		font-size: 0.875rem;
		line-height: 1.5;
		color: var(--rz-text-color);
	}

	.card-title-help-link {
		display: inline-flex;
		align-items: center;
		gap: 0.375rem;
		color: var(--rz-info);
		text-decoration: none;
		font-weight: 500;
	}

	.card-title-help-link:hover {
		text-decoration: underline;
	}

	.card-title-help-link .rzi {
		font-size: 0.875rem;
	}

	.card-title-help-close {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 1.5rem;
		height: 1.5rem;
		padding: 0;
		border: none;
		border-radius: 0.25rem;
		background: transparent;
		color: var(--rz-text-secondary-color);
		cursor: pointer;
		flex-shrink: 0;
		transition: all 0.15s ease;
	}

	.card-title-help-close:hover {
		background: var(--rz-base-300);
		color: var(--rz-text-color);
	}

	.card-title-help-close .rzi {
		font-size: 1rem;
	}
</style>
