@if (HighlightColor != HighlightColorType.Undefined)
{
	<RadzenCard Variant="Variant.Filled" Style="@GetGradient()" class="@Class">
		<div class="d-flex flex-column gap-2 text-white">
			<div class="d-flex justify-content-between align-items-center gap-2">
				<div>
					<div class="rz-text-caption opacity-75">@Title</div>
					<div class="d-flex align-items-center gap-3">
						@if (IsNumericValue && NumericValue.HasValue)
						{
							@if (NumericValue >= 0)
							{
								<RadzenIcon Icon="trending_up" Style="font-size:32px" />
							}
							else
							{
								<RadzenIcon Icon="trending_down" Style="font-size:32px" />
							}
						}
						<span style="font-size:2.5rem;">@Value</span>
					</div>
				</div>
				@if (!string.IsNullOrEmpty(Icon))
				{
					<RadzenIcon Icon="@Icon" Style="font-size:64px; opacity:0.3" />
				}
			</div>
		</div>
	</RadzenCard>
}
else
{
	<RadzenCard Variant="@Variant" class="@Class" Style="@Style">
		<div class="dz-kpi-content">
			@if (!string.IsNullOrEmpty(Icon))
			{
				<RadzenIcon Icon="@Icon" Style="@($"font-size: 2rem;color: {Color};")" />
				<RadzenText TextStyle="TextStyle.Subtitle1">@Title</RadzenText>
				<RadzenText TextStyle="TextStyle.DisplayH6" Style="@($"color: {Color};")">
					@Value
				</RadzenText>
			}
			else
			{
				<RadzenText TextStyle="TextStyle.DisplayH6" Style="@($"color: {Color};")">@Value</RadzenText>
				<RadzenText TextStyle="TextStyle.Subtitle1">@Title</RadzenText>
			}

			@if (!string.IsNullOrEmpty(Description))
			{
				<RadzenText TextStyle="TextStyle.Caption" Style="color: gray;" class="w-100">
					@Description
				</RadzenText>
			}

			@if (!string.IsNullOrEmpty(ButtonText))
			{
				<RadzenButton Text="@ButtonText" Variant="Variant.Text" Click="@OnClick" Icon="@ButtonIcon" />
			}
		</div>
	</RadzenCard>
}

@code {
	[Parameter] public string Class { get; set; } = "";
	[Parameter] public string Style { get; set; } = "";
	[Parameter] public string Title { get; set; } = "";
	[Parameter] public string Icon { get; set; } = "";
	[Parameter] public string Color { get; set; } = "black";
	[Parameter] public string Value { get; set; } = "";
	[Parameter] public string Description { get; set; } = "";
	[Parameter] public EventCallback OnClick { get; set; }
	[Parameter] public string ButtonText { get; set; } = "";
	[Parameter] public string ButtonIcon { get; set; } = "";
	[Parameter] public HighlightColorType HighlightColor { get; set; } = HighlightColorType.Undefined;
	[Parameter] public Radzen.Variant Variant { get; set; } = Radzen.Variant.Filled;

	public enum HighlightColorType
	{
		Undefined,
		Auto,
		Red,
		Blue,
		Green,
		Yellow,
		Orange,
		Purple,
		Black,
		White,
		Gray
	}

	private bool IsNumericValue => decimal.TryParse(Value, out _);
	private decimal? NumericValue => decimal.TryParse(Value, out var v) ? v : null;

	private string GetGradient()
	{
		var color = HighlightColor;

		if (color == HighlightColorType.Auto)
		{
			var hasNonZeroDigit = Value.Any(c => char.IsDigit(c) && c != '0');
			var hasMinusSign = Value.Contains('-');

			if (hasNonZeroDigit)
				color = hasMinusSign ? HighlightColorType.Red : HighlightColorType.Green;
			else
				color = HighlightColorType.Gray;
		}

		return color switch
		{
			HighlightColorType.Green => "background: linear-gradient(135deg, #a4f371 0%, #4CAF50 100%)",
			HighlightColorType.Red => "background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)",
			HighlightColorType.Blue => "background: linear-gradient(135deg, #64b5f6 0%, #2196F3 100%)",
			HighlightColorType.Yellow => "background: linear-gradient(135deg, #fff176 0%, #FFEB3B 100%)",
			HighlightColorType.Orange => "background: linear-gradient(135deg, #ffb74d 0%, #FF9800 100%)",
			HighlightColorType.Purple => "background: linear-gradient(135deg, #ba68c8 0%, #9C27B0 100%)",
			HighlightColorType.Black => "background: linear-gradient(135deg, #757575 0%, #212121 100%)",
			HighlightColorType.White => "background: linear-gradient(135deg, #fafafa 0%, #ffffff 100%)",
			HighlightColorType.Gray => "background: linear-gradient(135deg, #bdbdbd 0%, #9E9E9E 100%)",
			_ => ""
		};
	}
}
